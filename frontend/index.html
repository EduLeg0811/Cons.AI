<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cons-AI ● Toolbox de IA da Conscienciologia</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="/styles/style.css">

    <link rel="icon" type="image/png" href="icon.png">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />



    <!-- style.overrides.css merged into style.bundle.css -->
    <style>
      /* Overlay do zoom do logo */
      #logo-intro-overlay {
        position: fixed;
        left: 0; right: 0; top: 0; bottom: 0; /* cobre inclusive a navbar */
        display: none;
        align-items: center;
        justify-content: center;
        background: #ffffff; /* Fundo branco para não contrastar com o logo */
        z-index: 9999;
        opacity: 0; /* inicia transparente para permitir fade-in */
        transition: opacity 1s ease; /* transição suave na entrada */
      }
      #logo-intro-overlay.show { display: flex; opacity: 0; }
      #logo-intro-overlay.visible { opacity: 1; }
      #logo-intro-overlay.fade { animation: logoFadeOut 1s ease-in-out forwards; }

      .logo-intro-img {
        width: 160px; height: 160px;
        object-fit: contain;
        will-change: transform, opacity;
      }
      /* 3s: zoom do centro até preencher */
      .logo-intro-img.animate { animation: logoFadeIn 2s ease-out forwards, logoZoom 3s ease-in-out forwards; }

      @keyframes logoZoom {
        0% {
          transform: scale(0.2);
          opacity: 1;
        }
        100% {
          transform: scale(6);
          opacity: 1;
        }
      }
      @keyframes logoFadeIn {
        0% { opacity: 0; }
        100% { opacity: 1; }
      }
      @keyframes logoFadeOut {
        0% { opacity: 1; }
        100% { opacity: 0; }
      }

      /* Preferência reduzida de movimento */
      @media (prefers-reduced-motion: reduce) {
        .logo-intro-img.animate { animation-duration: 0.01ms; animation-iteration-count: 1; }
        #logo-intro-overlay.fade { animation-duration: 0.01ms; }
      }
      /* Bloqueio de rolagem durante o efeito */
      html.no-scroll, body.no-scroll { overflow: hidden; }
      /* Fade-out do conteúdo de fundo durante a intro */
      .navbar, .main-content, .footer { transition: opacity 1s ease; }
      html.fade-out-main .navbar,
      html.fade-out-main .main-content,
      html.fade-out-main .footer { opacity: 0; }
    </style>
    <script>
      // Pré-aplica tela em branco e bloqueio de rolagem no PRIMEIRO acesso da sessão
      // Executa o mais cedo possível para evitar flash de conteúdo
      try {
        if (!sessionStorage.getItem('logoIntroShown')) {
          document.documentElement.classList.add('no-scroll', 'fade-out-main');
        }
      } catch (e) { /* ignore */ }
    </script>
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z9C5503JC6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z9C5503JC6');
</script>


<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
          
          <!-- Botão esquerdo -->
          <button class="navbar-control-btn info-toggle" title="Mostrar/ocultar descrições" onclick="toggleInfo()">
            <img class="navbar-logo" src="/Icon.png" alt="Books in the Parabrain" />
          </button>
      
          <!-- Título central -->
          <div class="navbar-center">
            <a href="#" class="navbar-brand">


              <div class="navbar-text">
                <!--<img class="navbar-logo" src="/Icon.png" alt="Books in the Parabrain" />-->
                <div class="navbar-heading">
                  <div class="navbar-title">Cons-IA</div>
                  <div class="navbar-subtitle">Toolbox de IA da Conscienciologia</div>
                </div>
              </div>



            </a>
          </div>

          <!-- Botão de Configuração
          <button class="navbar-control-btn config-toggle" title="Configurações" onclick="toggleConfig()">
            <i class="fas fa-cog"></i>
          </button> -->
      
          <!-- Botão direito -->
          <button class="navbar-control-btn theme-toggle" title="Toggle Theme" onclick="toggleTheme()">
            <i class="fas fa-moon"></i>
            <i class="fas fa-sun"></i>
          </button>
      
        </div>
      </nav>
      

    <!-- Main Content -->
    <main class="main-content">
        <div class="tools-section">
            <div class="tools-grid">



                <!-- Bots Panel -->
                <div class="tool-panel bots">

                    <!-- Panel Header -->
                    <div class="panel-header">
                        <div class="panel-info">
                            <h2>Bots IA</h2>
                            <p></p>
                        </div>
                    </div>

                    <div class="tools-list">


                        <a href="https://chatgpt.com/g/g-68a5d68b96c4819189dd1e6fb0def83f-consgpt?model=gpt-5.1" class="tool-card compact" target="_blank" rel="noopener noreferrer">
                           <div class="tool-icon openai">
                                <img src="/styles/openai-brands-solid-full.svg" alt="OpenAI" class="icon-26" />
                            </div>
                            <div class="tool-info">
                                <h3>ConsGPT</h3>
                                <p></p>
                                <div class="tool-info-extra"></div>
                            </div>
                        </a>

                        <a href="https://notebooklm.google.com/notebook/c3528e65-0c2b-4a80-b3f2-2f22e3626b67" class="tool-card compact" target="_blank" rel="noopener noreferrer">
                            <div class="tool-icon google">
                                <i class="fa-brands fa-google"></i>
                            </div>
                            <div class="tool-info">
                                <h3>ConsLM</h3>
                                <p></p>
                                <div class="tool-info-extra"></div>
                            </div>
                        </a>

                        <a href="index_ragbot.html" class="tool-card compact" style="position:relative; overflow:visible;">
                            <div class="tool-icon ragbot">
                                <i class="fa-solid fa-graduation-cap"></i>
                            </div>
                            <div class="tool-info">
                                <h3>ConsBOT</h3>
                                <p></p>
                                <div class="tool-info-extra"></div>
                            </div>
                            <span>
                                <img src="/styles/flagUK.png" alt="Icon" class="icon-uk">
                            </span>

                             <span>
                                <img src="/styles/star3d.png" alt="Icon" class="icon-star">
                            </span>

                            <!--
                            <span class="badge-new">
                                New
                            </span>
                            -->
                            
                        </a>


                    </div>
                </div>



                <!-- Lexical Panel -->
                <div class="tool-panel search">
                    <div class="panel-header">
                        <div class="panel-info">
                            <h2>Busca IA</h2>
                            <p></p>
                        </div>
                    </div>
                    <div class="tools-list">

                        <a href="index_search_book.html" class="tool-card lexical-compact compact" style="position:relative; overflow:visible;">
                            <div class="tool-icon lexical">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="tool-info">
                                <h3>Livros & Tratados</h3>
                                <p></p>
                                <div class="tool-info-extra"></div>
                            </div>

                              <span>
                                <img src="/styles/star3d.png" alt="Icon" class="icon-star">
                            </span>
                        </a>

                        <a href="index_search_verb.html" class="tool-card lexical-compact compact" style="position:relative; overflow:visible;">
                            <div class="tool-icon lexical">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="tool-info">
                                <h3>Definologia de Verbetes</h3>
                                <p></p>
                                <div class="tool-info-extra"></div>
                            </div>

                            <!-- <span class="badge-hot">
                                Hot 
                            </span> -->

                             <span>
                                <img src="/styles/star3d.png" alt="Icon" class="icon-star">
                            </span>
            
                        </a>

                        <a href="index_search_ccg.html" class="tool-card lexical-compact compact">
                            <div class="tool-icon lexical">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="tool-info">
                                <h3>Questões do Conscienciograma</h3>
                                <p></p>
                                <div class="tool-info-extra"></div>
                            </div>
                        </a>

                        
                    </div>
                </div>



                <!-- semantic Panel
                <div class="tool-panel sem">
                    <div class="panel-header">
                        <div class="panel-info">
                            <h2>Deep Research IA</h2>
                            <p></p>
                        </div>
                    </div>
                    <div class="tools-list">
                        
                        <a href="index_deepdive.html" class="tool-card compact">
                            <div class="tool-icon semantic">
                                <i class="fa-solid fa-book-open-reader"></i>
                            </div>
                            <div class="tool-info">
                                <h3>Caderno de Estudos</h3>
                                <p></p>
                                <div class="tool-info-extra"></div>
                            </div>
                        </a>

                    </div>
                </div>
            -->



                <!-- Playground Panel -->
                <div class="tool-panel apps">
                    <div class="panel-header">
                        <div class="panel-info">
                            <h2>Apps IA</h2>
                            <p></p>
                        </div>
                    </div>
                    <div class="tools-list">

                        
                        <a href="index_mancia.html" class="tool-card compact" style="position:relative; overflow:visible;">
                            <div class="tool-icon mancia">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div class="tool-info">
                                <h3>Bibliomancia Digital</h3>
                                <p></p>
                                <div class="tool-info-extra"></div>
                            </div>

                              <span>
                                <img src="/styles/star3d.png" alt="Icon" class="icon-star">
                            </span>
                        </a>


                        <a href="index_quiz.html" class="tool-card compact">
                            <div class="tool-icon quiz">
                                <i class="fa-regular fa-lightbulb"></i>
                            </div>
                            <div class="tool-info">
                                <h3>Quiz Conscienciológico</h3>
                                <p></p>
                                <div class="tool-info-extra"></div>
                            </div>
                        </a>

                    </div>
                </div>




                <!-- Utils Panel -->
                <div class="tool-panel utils">
                    <div class="panel-header">
                        <div class="panel-info">
                            <h2>Links Externos</h2>
                            <p></p>
                        </div>
                    </div>

                    <div class="tools-list">
                        <a href="https://www.icge.org.br/" class="tool-card compact" target="_blank" rel="noopener noreferrer">
                            <div class="tool-icon encyclopedia">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="tool-info">
                                <h3>ICGE</h3>
                                <p></p>
                            </div>
                        </a>

                        <a href="https://enciclopediadaconscienciologia.org/" class="tool-card compact" target="_blank" rel="noopener noreferrer">
                            <div class="tool-icon encyclopedia">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="tool-info">
                                <h3>Enciclopédia da Conscienciologia</h3>
                                <p></p>
                            </div>
                        </a>

                        <a href="https://conscienciologia.org.br/" class="tool-card compact" target="_blank" rel="noopener noreferrer">
                            <div class="tool-icon encyclopedia">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="tool-info">
                                <h3>Portal da Conscienciologia</h3>
                                <p></p>
                            </div>
                        </a>

                        <a href="https://periodicos.conscienciologia.org.br/" class="tool-card compact" target="_blank" rel="noopener noreferrer">
                            <div class="tool-icon encyclopedia">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="tool-info">
                                <h3>Portal de Periódicos</h3>
                                <p></p>
                            </div>
                        </a>

                    </div>
                </div>

            </div>
        </div>
        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">

                <div class="footer-feedback">
                    <button id="feedbackPill" class="pill pill-action" type="button" aria-haspopup="dialog" aria-controls="feedbackOverlay">Envie seu feedback</button>
                </div>

                <div class="footer-text">
                    ©2025 Cons-IA.org
                </div>
                
                <div class="footer-contact">
                    <span>Fale com o Diretor:</span>
                    <a href="mailto:legadologia@gmail.com">
                        <i class="fas fa-envelope"></i>
                        <span class="email"><em>transmentor@interludium.ccce</em></span>
                    </a>
                </div>
            </div>
        </footer>
    </main>

    <!-- Feedback Overlay -->
    <div id="feedbackOverlay" class="fb-overlay" role="dialog" aria-modal="true" aria-labelledby="fbTitle" hidden>
      <div class="fb-dialog">
        <h3 id="fbTitle">Enviar Feedback</h3>
        <p class="fb-help">Sua mensagem será enviada aos desenvolvedores.</p>
        <textarea id="fbInput" rows="4" placeholder="Escreva aqui sua mensagem..."></textarea>
        <div class="fb-actions">
          <button id="fbSend" class="btn primary" type="button">Enviar</button>
          <button id="fbCancel" class="btn" type="button">Cancelar</button>
        </div>
        <div id="fbStatus" class="fb-status" aria-live="polite"></div>
      </div>
    </div>

    <!-- Overlay de animação do logo -->
    <div id="logo-intro-overlay" aria-hidden="true">
      <img class="logo-intro-img" src="/Icon.png" alt="Logo" />
    </div>

    <script src="config.js"></script>
    <script src="utils.js"></script>
    <script src="messages.js"></script>
    <script>


      // Delegated click logger for module cards
      document.addEventListener('click', function(e){
        try {
          const card = e.target.closest('.tools-list a.tool-card');
          if (!card) return;
          const panel = card.closest('.tool-panel');
          const panelClasses = panel ? Array.from(panel.classList) : [];
          const groups = ['bots','search','apps','semantic','utils'];
          const module_group = panelClasses.find(c => groups.includes(c));
          const module_label = (card.querySelector('h3')?.textContent || card.getAttribute('aria-label') || card.textContent || '').trim();
          const module_href = card.getAttribute('href') || '';
          if (window.logEvent) {
            window.logEvent({
              event: 'module_click',
              module_label,
              module_href,
              module_group
            });
          }
        } catch (err) { /* noop */ }
      });



      // Feedback pill interactions
      (function setupFeedback(){
        const pill = document.getElementById('feedbackPill');
        const overlay = document.getElementById('feedbackOverlay');
        const input = document.getElementById('fbInput');
        const sendBtn = document.getElementById('fbSend');
        const cancelBtn = document.getElementById('fbCancel');
        const status = document.getElementById('fbStatus');

        function openOverlay(){
          try { status.textContent = ''; } catch {}
          overlay.hidden = false;
          input.value = '';
          input.focus();
        }
        function closeOverlay(){ overlay.hidden = true; }
        function send(){
          const msg = (input.value || '').trim();
          if (!msg) { status.textContent = 'Digite uma mensagem.'; input.focus(); return; }
          try {
            if (window.logEvent) {
              window.logEvent({ event: 'feedback_message', module: 'feedback', value: msg });
              status.textContent = 'Feedback enviado! Agradecemos sua mensagem.';
            } else {
            // fallback direta ao endpoint
            const payload = {
              event: 'feedback_message',
              module: 'feedback',
              value: msg,
              page: (location && location.pathname) || undefined,
              origin: (location && location.origin) || (location.protocol + '//' + location.host),
              referrer: document.referrer || ''
            };
            fetch((window.apiBaseUrl||'') + '/log', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) })
              .then(() => status.textContent = 'Feedback enviado! Agradecemos sua mensagem.')
              .catch(() => status.textContent = 'Falha ao enviar. Tente novamente.');
          }
          } catch { status.textContent = 'Falha ao enviar. Tente novamente.'; }
          setTimeout(closeOverlay, 1000);
        }

        pill?.addEventListener('click', openOverlay);
        cancelBtn?.addEventListener('click', closeOverlay);
        sendBtn?.addEventListener('click', send);
        input?.addEventListener('keydown', (e) => { if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) send(); });
        overlay?.addEventListener('click', (e) => { if (e.target === overlay) closeOverlay(); });
      })();



            // Info toggle (expand/collapse badge descriptions)
            function playLogoIntro(callback){
              try {
                const overlay = document.getElementById('logo-intro-overlay');
                const img = overlay ? overlay.querySelector('.logo-intro-img') : null;
                if (!overlay || !img) { if (callback) callback(); return; }
                // prepara
                overlay.classList.remove('fade');
                img.classList.remove('animate');
                // força reflow antes de iniciar animação (overlay e imagem)
                void overlay.offsetWidth;
                void img.offsetWidth;
                // bloqueia rolagem
                document.documentElement.classList.add('no-scroll');
                document.body.classList.add('no-scroll');
                // Esconde o conteúdo de informações no início
                document.documentElement.removeAttribute('data-show-info');
                
                // fade-out do conteúdo ao fundo por 1s
                document.documentElement.classList.add('fade-out-main');
                overlay.classList.add('show');
                
                // ativa o crossfade em próximo frame (evita salto ao trocar display)
                requestAnimationFrame(() => {
                  requestAnimationFrame(() => {
                    overlay.classList.add('visible');
                    img.classList.add('animate');
                  });
                });
                
                // após 4s de zoom + 1s estável, dispara fade de 1s do logo
                setTimeout(() => {
                  overlay.classList.add('fade');
                }, 4000);
                
                // ao final (4s + 1s + 1s), oculta overlay e chama callback
                setTimeout(() => {
                  // Remove o overlay e libera a rolagem
                  overlay.classList.remove('visible', 'show', 'fade');
                  document.documentElement.classList.remove('no-scroll');
                  document.body.classList.remove('no-scroll');
                  
                  // Remove o fade do conteúdo principal
                  document.documentElement.classList.remove('fade-out-main');
                  
                  // Chama o callback
                  if (callback) callback();
                }, 5000);
              } catch (e) { if (callback) callback(); }
            }

            function toggleInfo() {
                const current = document.documentElement.getAttribute('data-show-info') === 'true';
                const turningOn = !current;

                // On first user interaction, stop the pulsing permanently
                try {
                  if (!localStorage.getItem('infoPulseSeen')) {
                      localStorage.setItem('infoPulseSeen', 'true');
                  }
                } catch (e) { /* ignore */ }
                document.documentElement.setAttribute('data-info-pulse', 'off');

                if (turningOn) {
                  // Já aplica o estado de informações antes da animação,
                  // para evitar flash do estado anterior quando o overlay some
                  document.documentElement.setAttribute('data-show-info', 'true');
                  // Não aciona mais animação de logo ao clicar no ícone de info
                } else {
                  // Desliga imediatamente
                  document.documentElement.setAttribute('data-show-info', 'false');
                }
            }

           

            // Initialize theme when DOM is loaded
            document.addEventListener('DOMContentLoaded', initTheme);

            // Disable pulse if user has already interacted before
            document.addEventListener('DOMContentLoaded', function() {
                try {
                    if (localStorage.getItem('infoPulseSeen') === 'true') {
                        document.documentElement.setAttribute('data-info-pulse', 'off');
                    }
                } catch (e) {
                    // If localStorage unavailable, ignore
                }
            });


             // Play logo intro once per session (first visit only)
            document.addEventListener('DOMContentLoaded', function () {
              try {
                if (!sessionStorage.getItem('logoIntroShown')) {
                  sessionStorage.setItem('logoIntroShown', 'true');
                  playLogoIntro();
                }
              } catch (e) { /* ignore */ }
            });


            
            // ==================== Config Modal Logic ====================
            function openConfigModal() {
              const el = document.getElementById('config-backdrop');
              if (!el) return;
              try { loadConfigForm(); } catch {}
              el.style.display = 'flex';
              el.setAttribute('aria-hidden', 'false');
              // mark page as having modal open (for CSS blur)
              document.documentElement.setAttribute('data-config-open', 'true');
            }
            function closeConfigModal() {
              const el = document.getElementById('config-backdrop');
              if (!el) return;
              el.style.display = 'none';
              el.setAttribute('aria-hidden', 'true');
              // remove modal-open marker
              document.documentElement.removeAttribute('data-config-open');
            }
            function toggleConfig(){ openConfigModal(); }




            // ==================== Config Modal Logic ====================
            function loadConfigForm() {
              try {
                const $ = (id) => document.getElementById(id);

                // =============================================================
                // 1. Ler configurações salvas do localStorage (ou usar padrão)
                // =============================================================
                let config = {};
                try {
                  config = JSON.parse(localStorage.getItem("appConfig_main") || "{}");
                } catch {
                  config = {};
                }

                // Se ainda não existir, usa valores padrão mínimos
                config.MODEL_LLM = config.MODEL_LLM || MODEL_LLM;
                config.MODEL_RAGBOT = config.MODEL_RAGBOT || MODEL_RAGBOT;
                config.TEMPERATURE = config.TEMPERATURE ?? TEMPERATURE;
                config.MAX_RESULTS_DISPLAY = config.MAX_RESULTS_DISPLAY || MAX_RESULTS_DISPLAY;
                config.OPENAI_RAGBOT = config.OPENAI_RAGBOT || OPENAI_RAGBOT;
                config.FULL_BADGES = !!config.FULL_BADGES;
                config.MINITERTULIA = !!config.MINITERTULIA;
                // Novo flag: DESCRITIVOS (usa default de window.CONFIG, se existir)
                const defaultDescr = (window.CONFIG && typeof window.CONFIG.DESCRITIVOS !== 'undefined')
                  ? !!window.CONFIG.DESCRITIVOS
                  : false;
                if (typeof config.DESCRITIVOS === 'undefined' || config.DESCRITIVOS === null || config.DESCRITIVOS === '') {
                  config.DESCRITIVOS = defaultDescr;
                } else {
                  config.DESCRITIVOS = !!config.DESCRITIVOS;
                }

                // Atualiza o objeto global
                window.CONFIG = config;

                // =============================================================
                // 2. Preenche os campos da interface
                // =============================================================

                if ($('cfg-model-llm')) $('cfg-model-llm').value = config.MODEL_LLM;
                if ($('cfg-model-ragbot')) $('cfg-model-ragbot').value = config.MODEL_RAGBOT;

                // Temperatura (slider único)
                const range = $('cfg-temperature');
                const label = document.getElementById('cfg-temperature-label');
                if (range && label) {
                  range.value = Math.min(Math.max(Number(config.TEMPERATURE), 0.1), 1.0);
                  label.textContent = `(${Number(range.value).toFixed(1)})`;
                  range.addEventListener('input', () => {
                    label.textContent = `(${Number(range.value).toFixed(1)})`;
                  });
                }

                // Max results
                const cap = getMaxResultsCap ? getMaxResultsCap() : 500;
                const floor = getMinResultsFloor ? getMinResultsFloor() : 1;
                const maxInput = $('cfg-max-results');
                if (maxInput) {
                  maxInput.setAttribute('min', String(floor));
                  maxInput.setAttribute('max', String(cap));
                  maxInput.value = String(
                    Math.min(Math.max(Number(config.MAX_RESULTS_DISPLAY), floor), cap)
                  );
                }

                // RAGBOT
                if ($('cfg-openai-ragbot')) $('cfg-openai-ragbot').value = config.OPENAI_RAGBOT;

                // Checkboxes
                if ($('cfg-full-badges')) $('cfg-full-badges').checked = !!config.FULL_BADGES;
                if ($('cfg-minitertulia')) $('cfg-minitertulia').checked = !!config.MINITERTULIA;
                if ($('cfg-descritivos')) $('cfg-descritivos').checked = !!config.DESCRITIVOS;

              } catch (e) {
                console.error("Erro ao carregar configurações:", e);
              }
            }


            // ==================== Save Config Modal Logic ====================
            function saveConfigAndClose() {
              try {
                const $ = (id) => document.getElementById(id);
                const newConfig = {
                  // Model settings
                  MODEL_LLM: $('cfg-model-llm')?.value || window.CONFIG.MODEL_LLM,
                  MODEL_RAGBOT: $('cfg-model-ragbot')?.value || window.CONFIG.MODEL_RAGBOT,
                  
                  TEMPERATURE: Math.min(Math.max(
                    Number($('cfg-temperature')?.value || TEMPERATURE),
                    0.1
                  ), 1.0),


                  MAX_RESULTS_DISPLAY: normalizeMaxResults(
                    $('cfg-max-results')?.value || window.CONFIG.MAX_RESULTS_DISPLAY
                  ),
                  
                  // Feature flags
                  OPENAI_RAGBOT: $('cfg-openai-ragbot')?.value || OPENAI_RAGBOT,
                  FULL_BADGES: !!$('cfg-full-badges')?.checked,
                  MINITERTULIA: !!$('cfg-minitertulia')?.checked,
                  DESCRITIVOS: !!$('cfg-descritivos')?.checked,
                };

                // Save to localStorage and update runtime config
                localStorage.setItem('appConfig_main', JSON.stringify(newConfig));
                
                // Update global config
                Object.assign(window.CONFIG, newConfig);
                
                // Update legacy variables
                window.USER_MAX_RESULTS = window.CONFIG.MAX_RESULTS_DISPLAY;
                window.USER_TEMPERATURE = window.CONFIG.TEMPERATURE;
                
                closeConfigModal();
                
              } catch (e) {
                console.error('Error saving configuration:', e);
                alert('Erro ao salvar configurações. Verifique o console para mais detalhes.');
              }
            }

            // Open via config button, and long-press on info icon (5s)
            document.addEventListener('DOMContentLoaded', function() {
              const infoBtn = document.querySelector('.info-toggle');
              let pressTimer = null; let longPressed = false;
              const start = () => { longPressed = false; clearTimeout(pressTimer); pressTimer = setTimeout(() => { longPressed = true; openConfigModal(); }, 5000); };
              const cancel = (e) => { clearTimeout(pressTimer); if (longPressed && e) { e.preventDefault(); e.stopPropagation(); } };
              if (infoBtn) {
                infoBtn.addEventListener('mousedown', start);
                infoBtn.addEventListener('touchstart', start, { passive: true });
                ['mouseup','mouseleave','touchend','touchcancel'].forEach(ev => infoBtn.addEventListener(ev, cancel, { passive: false }));
                infoBtn.addEventListener('click', function(e){ if (longPressed) { e.preventDefault(); e.stopPropagation(); } });
              }
              const backdrop = document.getElementById('config-backdrop');
              if (backdrop) { backdrop.addEventListener('click', function(e){ if (e.target === backdrop) closeConfigModal(); }); }
            });

        </script>

    <!-- Config Modal Styles and Markup --><div id="config-backdrop" class="config-modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="config-modal" role="document">
        <header>
          <span>System Settings</span>
          <button class="btn" type="button" onclick="closeConfigModal()" aria-label="Fechar">Close</button>
        </header>
        <div class="content">
          <div class="config-grid">
            <div class="config-field">
              <label for="cfg-model-llm">MODEL_LLM</label>
              <select id="cfg-model-llm">
                <option value="gpt-5.1">gpt-5.1</option>
                <option value="gpt-4.1-nano">gpt-4.1-nano</option>
                <option value="gpt-4.1-mini">gpt-4.1-mini</option>
              </select>
            </div>
            <div class="config-field">
              <label for="cfg-model-ragbot">MODEL_RAGBOT</label>
              <select id="cfg-model-ragbot">
                <option value="gpt-5.1">gpt-5.1</option>
                <option value="gpt-4.1-nano">gpt-4.1-nano</option>
                <option value="gpt-4.1-mini">gpt-4.1-mini</option>
              </select>
            </div>
            
            <div class="config-field">
              <label for="cfg-temperature">
                TEMPERATURE
                <span id="cfg-temperature-label" class="config-help"></span>
              </label>
              <div class="config-inline">
                <input id="cfg-temperature" type="range" min="0.1" max="1" step="0.1" value="0.3" />
              </div>
            </div>

            <div class="config-field">
              <label for="cfg-max-results">MAX_RESULTS_DISPLAY <span class="config-help" data-max-results-range></span></label>
              <input id="cfg-max-results" type="number" data-max-config="true" step="10" value="100" />
            </div>
            <div class="config-field">
              <label for="cfg-openai-ragbot">OPENAI_RAGBOT</label>
              <select id="cfg-openai-ragbot">
                <option value="ALLWV">ALLWV</option>
                <option value="EDUNOTES">EDUNOTES</option>
              </select>
            </div>
            <div class="config-field full">
              <label for="cfg-full-badges">FULL_BADGES</label>
              <div class="config-inline">
                <input id="cfg-full-badges" type="checkbox" />
                <span class="config-help">Exibe badges completos nas respostas</span>
              </div>
            </div>
            <div class="config-field full">
              <label for="cfg-minitertulia">MINITERTULIA</label>
              <div class="config-inline">
                <input id="cfg-minitertulia" type="checkbox" />
                <span class="config-help">Registros da Minitertulia</span>
              </div>
            </div>
          </div>
        </div>
        <div class="config-actions">
          <button class="btn" type="button" onclick="closeConfigModal()">Cancelar</button>
          <button class="btn primary" type="button" onclick="saveConfigAndClose()">Salvar</button>
        </div>
      </div>
    </div>
</body>
</html>



